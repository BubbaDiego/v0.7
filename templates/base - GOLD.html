<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pie Chart with Image Slices</title>
  <!-- Include ApexCharts from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.36.3"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      margin: 20px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    /* Set the chart container to fixed size and relative positioning */
    #chartContainer {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 0 auto;
    }
    /* Ensure the chart canvas fills the container */
    #chart {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <h1>Pie Chart with Asset & Wallet Images</h1>
  <div id="chartContainer">
    <div id="chart"></div>
  </div>

  <script>
    // Our canned data (e.g., positions sizes)
    const seriesData = [40, 30, 20, 10];  // Sum = 100
    // Asset images for each slice (outer layer)
    const assetImages = [
      'https://via.placeholder.com/50x50.png?text=A1',
      'https://via.placeholder.com/50x50.png?text=A2',
      'https://via.placeholder.com/50x50.png?text=A3',
      'https://via.placeholder.com/50x50.png?text=A4'
    ];
    // Wallet icon images (to overlay inside the slice)
    const walletImages = [
      'https://via.placeholder.com/25x25.png?text=W1',
      'https://via.placeholder.com/25x25.png?text=W2',
      'https://via.placeholder.com/25x25.png?text=W3',
      'https://via.placeholder.com/25x25.png?text=W4'
    ];

    // Configure the pie chart to use asset images as the fill.
    const options = {
      chart: {
        type: 'pie',
        height: 400,
        width: 400,
        // Set startAngle to 0 for easier calculations
        startAngle: 0
      },
      series: seriesData,
      // We donâ€™t show any text labels
      labels: [],
      dataLabels: {
        enabled: false
      },
      legend: {
        show: false
      },
      tooltip: {
        enabled: false
      },
      fill: {
        type: 'image',
        image: {
          // Use assetImages array for each slice
          src: assetImages,
          width: 50,
          height: 50
        }
      },
      plotOptions: {
        pie: {
          expandOnClick: false
        }
      }
    };

    // Render the chart
    const chart = new ApexCharts(document.querySelector("#chart"), options);
    chart.render().then(() => {
      // After the chart is rendered, overlay the wallet icons.
      // We assume fixed container size: 400x400 and center at (200,200)
      const container = document.getElementById("chartContainer");
      const centerX = 200;
      const centerY = 200;
      // Choose a radius for wallet icon placement (adjust as needed)
      const radius = 100; 
      const total = seriesData.reduce((a, b) => a + b, 0);
      let startAngle = 0; // in degrees
      const walletPositions = [];
      
      // Compute the center angle for each slice and convert to (x,y) positions.
      for (let i = 0; i < seriesData.length; i++) {
        const sliceAngle = seriesData[i] / total * 360; // degrees for this slice
        const centerAngle = startAngle + sliceAngle / 2;  // center angle of the slice in degrees
        const rad = centerAngle * Math.PI / 180; // convert to radians
        
        // Compute x,y coordinates; subtract half the wallet icon size (assume 25px) to center it.
        const x = centerX + radius * Math.cos(rad) - 12.5;
        const y = centerY + radius * Math.sin(rad) - 12.5;
        walletPositions.push({x, y});
        
        startAngle += sliceAngle;
      }
      
      // Now create and position wallet icon <img> elements over the chart.
      walletPositions.forEach((pos, index) => {
        const img = document.createElement("img");
        img.src = walletImages[index];
        img.style.width = "25px";
        img.style.height = "25px";
        img.style.borderRadius = "50%";
        img.style.border = "2px solid white";
        img.style.position = "absolute";
        img.style.left = pos.x + "px";
        img.style.top = pos.y + "px";
        container.appendChild(img);
      });
    });
  </script>
</body>
</html>
