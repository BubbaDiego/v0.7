<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{% block title %}Sonic Dashboard{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="AdminLTE is a Free Bootstrap 5 Admin Dashboard, 30 example pages using Vanilla JS." />
    <meta name="keywords" content="bootstrap 5, admin dashboard, charts, adminlte" />
    <meta name="author" content="ColorlibHQ" />

    <!-- Fonts -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css" integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q=" crossorigin="anonymous" />

    <!-- OverlayScrollbars CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/styles/overlayscrollbars.min.css" integrity="sha256-tZHrRjVqNSRyWg2wbppGnT833E/Ys0DHWGwT04GiqQg=" crossorigin="anonymous" />

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI=" crossorigin="anonymous" />

    <!-- AdminLTEZ CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='AdminLTE/dist/css/adminlte.css') }}" />

    {% block extra_styles %}{% endblock %}
  </head>
  <body class="layout-fixed sidebar-expand-lg sidebar-mini sidebar-collapse bg-body-tertiary">
    <div class="app-wrapper">
      <!-- Header -->
      <nav class="app-header navbar navbar-expand {% if theme.navbar.bg %}{{ theme.navbar.bg }}{% else %}bg-body{% endif %}" data-bs-theme="{{ theme.navbar.color_mode }}">
        <div class="container-fluid">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" data-lte-toggle="sidebar" href="#" role="button">
                <i class="bi bi-list"></i>
              </a>
            </li>
            {# Extra Dashboard link removed from header #}
          </ul>
          <ul class="navbar-nav ms-auto">
            <!-- Color Mode Toggler -->
            <li class="nav-item dropdown">
              <button class="btn btn-link nav-link py-2 px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false">
                <span class="theme-icon-active"><i class="my-1"></i></span>
                <span class="d-lg-none ms-2" id="bd-theme-text">Toggle theme</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text" style="--bs-dropdown-min-width: 8rem">
                <li>
                  <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="light" aria-pressed="false">
                    <i class="bi bi-sun-fill me-2"></i>
                    Light
                    <i class="bi bi-check-lg ms-auto d-none"></i>
                  </button>
                </li>
                <li>
                  <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                    <i class="bi bi-moon-fill me-2"></i>
                    Dark
                    <i class="bi bi-check-lg ms-auto d-none"></i>
                  </button>
                </li>
                <li>
                  <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="true">
                    <i class="bi bi-circle-fill-half-stroke me-2"></i>
                    Auto
                    <i class="bi bi-check-lg ms-auto d-none"></i>
                  </button>
                </li>
              </ul>
            </li>
            <!-- End Color Mode Toggler -->
          </ul>
        </div>
      </nav>
      <!-- End Header -->

      <!-- Sidebar -->
      <aside class="app-sidebar shadow {% if theme.sidebar.bg %}{{ theme.sidebar.bg }}{% else %}bg-body-secondary{% endif %}" data-bs-theme="{{ theme.sidebar.color_mode }}">
        <div class="sidebar-brand">
          <a href="{{ url_for('dashboard.dashboard') }}" class="brand-link">
            <img src="{{ url_for('static', filename='images/corner_logo_owl.jpg') }}" alt="Admin Logo" class="brand-image rounded-circle shadow" />
            <span class="brand-text fw-light">AdminLTE 4</span>
          </a>
        </div>
        <div class="sidebar-wrapper">
          <nav class="mt-2">
            <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="menu" data-accordion="false">
              <li class="nav-item">
                <a href="{{ url_for('dashboard.dashboard') }}" class="nav-link">
                  <i class="nav-icon bi bi-speedometer"></i>
                  <p>Dashboard</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="{{ url_for('positions.position_trends') }}" class="nav-link">
                  <i class="nav-icon bi bi-briefcase"></i>
                  <p>Positions</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="{{ url_for('positions.show_top_positions') }}" class="nav-link">
                  <i class="nav-icon bi bi-star-fill"></i>
                  <p>Top Positions</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="{{ url_for('positions.positions_table') }}" class="nav-link">
                  <i class="nav-icon bi bi-table"></i>
                  <p>Positions Table</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="{{ url_for('prices.price_charts') }}" class="nav-link">
                  <i class="nav-icon bi bi-currency-dollar"></i>
                  <p>Prices</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="{{ url_for('positions.heat_report') }}" class="nav-link">
                  <i class="nav-icon bi bi-shield-check"></i>
                  <p>Hedge Report</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="{{ url_for('alerts_bp.alert_config_page') }}" class="nav-link">
                  <i class="nav-icon bi bi-exclamation-triangle-fill"></i>
                  <p>Alerts</p>
                </a>
              </li>
              <!-- New Portfolio Nav Item -->
              <li class="nav-item">
                <a href="{{ url_for('portfolio.index') }}" class="nav-link">
                  <i class="nav-icon bi bi-wallet2"></i>
                  <p>Portfolio</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="{{ url_for('database_viewer') }}" class="nav-link">
                  <i class="nav-icon bi bi-database"></i>
                  <p>Database</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="{{ url_for('dashboard.theme_options') }}" class="nav-link">
                  <i class="nav-icon bi bi-palette-fill"></i>
                  <p>Theme</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="{{ url_for('console_view') }}" class="nav-link">
                  <i class="nav-icon bi bi-terminal"></i>
                  <p>Console View</p>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </aside>
      <!-- End Sidebar -->

      <!-- Main Content -->
      <main class="app-main">
        <!-- App Content Header (Breadcrumb removed) -->
        <div class="app-content-header">
          <div class="container-fluid">
            <div class="row">
              <div class="col-12">
                <h3 class="mb-0">{% block page_title %}{% endblock %}</h3>
              </div>
            </div>
          </div>
        </div>
        <!-- End App Content Header -->

        <!-- App Content -->
        <div class="app-content">
          <div class="container-fluid">
            {% block content %}{% endblock %}
          </div>
        </div>
        <!-- End App Content -->
      </main>
      <!-- End Main Content -->

      <!-- Footer -->
      <footer class="app-footer">
        <div class="float-end d-none d-sm-inline">Sonic</div>
        <strong>&copy; 2014-2024 <a href="https://adminlte.io" class="text-decoration-none">AdminLTE.io</a>.</strong> All rights reserved.
      </footer>
    </div>
    <!-- End App Wrapper -->

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/browser/overlayscrollbars.browser.es6.min.js" integrity="sha256-dghWARbRe2eLlIJ56wNB+b760ywulqK3DzZYEpsg2fQ=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha256-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha256-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='AdminLTE/dist/js/adminlte.js') }}"></script>

    <!-- Chart Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

    <!-- Global Theme Script with Debug Logging -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        console.log("Global Theme Script: DOMContentLoaded fired.");
        const sidebarTheme = localStorage.getItem("sidebar_theme");
        const navbarTheme = localStorage.getItem("navbar_theme");
        console.log("Sidebar theme from localStorage:", sidebarTheme);
        console.log("Navbar theme from localStorage:", navbarTheme);

        const themeBg = [
          'bg-primary', 'bg-primary-subtle', 'bg-secondary', 'bg-secondary-subtle',
          'bg-success', 'bg-success-subtle', 'bg-danger', 'bg-danger-subtle',
          'bg-warning', 'bg-warning-subtle', 'bg-info', 'bg-info-subtle',
          'bg-light', 'bg-light-subtle', 'bg-dark', 'bg-dark-subtle',
          'bg-body-secondary', 'bg-body-tertiary', 'bg-body', 'bg-black',
          'bg-white', 'bg-transparent'
        ];

        // Apply Sidebar Theme Globally
        if (sidebarTheme) {
          try {
            const theme = JSON.parse(sidebarTheme);
            const appSidebar = document.querySelector('.app-sidebar');
            console.log("Found appSidebar:", appSidebar);
            if (appSidebar) {
              themeBg.forEach(cls => appSidebar.classList.remove(cls));
              appSidebar.setAttribute('data-bs-theme', theme.color_mode);
              if (theme.bg) {
                appSidebar.classList.add(theme.bg);
              }
              console.log("Applied sidebar theme:", theme);
            }
          } catch (e) {
            console.error("Error parsing sidebar_theme", e);
          }
        }

        // Apply Navbar Theme Globally
        if (navbarTheme) {
          try {
            const theme = JSON.parse(navbarTheme);
            const appNavbar = document.querySelector('.app-header');
            console.log("Found appNavbar:", appNavbar);
            if (appNavbar) {
              themeBg.forEach(cls => appNavbar.classList.remove(cls));
              appNavbar.setAttribute('data-bs-theme', theme.color_mode);
              if (theme.bg) {
                appNavbar.classList.add(theme.bg);
              }
              console.log("Applied navbar theme:", theme);
            }
          } catch (e) {
            console.error("Error parsing navbar_theme", e);
          }
        }
      });
    </script>

    {% block extra_scripts %}{% endblock %}

    {# If this is the index endpoint, redirect to dashboard #}
    {% if request.endpoint == 'index' %}
    <script>
      window.location.href = "{{ url_for('dashboard.dashboard') }}";
    </script>
    {% endif %}
  </body>
</html>
